# 核心分析逻辑说明

该目录包含了本研究项目的核心代码，用于展示从体外基因敲除模拟到最终生物学解释的完整分析流程。

## 文件与工作流

分析流程遵循以下顺序，每个脚本代表一个关键步骤：

### 1. `ovarian_cancer_perturbation_analysis.py`

- **目的**: 执行体外基因敲除 (in silico knockout) 的主脚本。
- **流程**:
    1. 加载预处理和令牌化 (tokenized) 的耐药组 (refractory) 和敏感组 (sensitive) 细胞数据集。
    2. 使用 `Geneformer` 模型为每个细胞生成基线嵌入 (baseline embeddings)。
    3. 对指定的目标基因列表 (例如 `SMARCA2`, `BRCA1` 等)，在耐药细胞中模拟敲除。
    4. 生成并保存敲除后的细胞嵌入。
- **角色**: **实验执行**

### 2. `refractory_to_sensitive_shift_analysis.py`

- **目的**: 定量分析基因敲除的效果。
- **流程**:
    1. 加载基线嵌入和敲除后的嵌入。
    2. 计算所有敏感细胞的平均嵌入，作为“理想的”敏感状态目标。
    3. 对每个被敲除的耐药细胞，计算其敲除前、后与“敏感状态”的余弦相似度。
    4. 计算**相似度变化量 (Similarity Shift)**，即 `相似度_后 - 相似度_前`。
    5. 将所有细胞和基因的计算结果保存为 `similarity_shift_results.csv`。
- **角色**: **结果量化**

### 3. `visualize_similarity_shift.py`

- **目的**: 将量化结果可视化。
- **流程**:
    1. 读取 `similarity_shift_results.csv` 文件。
    2. 生成箱线图 (Boxplot) 或小提琴图 (Violin Plot)，比较不同基因敲落引起的相似度变化分布。
    3. 生成其他总结性图表，直观展示哪个基因的效果最显著。
- **角色**: **结果展示**

### 4. `smarca2_responder_analysis.py`

- **目的**: 深入分析关键基因 (`SMARCA2`) 的作用机制。
- **流程**:
    1. 根据相似度变化是否为正，将被敲除了 `SMARCA2` 的细胞分为“响应组 (Responder)”和“无响应组 (Non-responder)”。
    2. 对这两组细胞进行差异表达基因 (DEG) 分析。
    3. 生成火山图 (Volcano Plot) 以展示显著变化的基因。
- **角色**: **机制探索**

### 5. `pathway_analysis.py`

- **目的**: 对差异表达的基因进行生物学功能解释。
- **流程**:
    1. 获取“响应组”和“无响应组”之间的差异表达基因列表。
    2. 使用该列表进行基因集富集分析 (GSEA)。
    3. 识别出在细胞状态转变过程中被显著激活或抑制的生物学通路。
- **角色**: **生物学解释**
